# Database Schema Export Directory

This directory contains exported database schemas for each version of the Room database.

## Purpose

Room exports the database schema as JSON files for each version. These files are used to:

1. **Validate migrations**: Ensure migrations correctly transform the database from one version to another
2. **Version control**: Track schema changes over time
3. **Documentation**: Provide a reference for the database structure at each version
4. **Testing**: Enable migration tests that verify data integrity

## Structure

Schema files are organized by database version:

```
schemas/
├── com.multiregionvpn.data.database.AppDatabase/
│   ├── 1.json          # Schema for version 1
│   ├── 2.json          # Schema for version 2 (when created)
│   └── ...
└── README.md           # This file
```

## Important

- **DO NOT** manually edit these files - they are auto-generated by Room
- **DO** commit these files to version control
- **DO** review schema changes during code reviews
- These files are generated during the build process when `exportSchema = true` is set in `@Database` annotation

## Schema Export Configuration

Schema export is configured in `app/build.gradle.kts`:

```kotlin
ksp {
    arg("room.schemaLocation", "$projectDir/schemas")
}
```

And enabled in `AppDatabase.kt`:

```kotlin
@Database(
    entities = [...],
    version = 1,
    exportSchema = true  // <-- Must be true
)
```

## Migration Testing

When adding a new migration, use these schema files to test:

```kotlin
@Test
fun migrate1To2() {
    val helper = MigrationTestHelper(
        InstrumentationRegistry.getInstrumentation(),
        AppDatabase::class.java,
        listOf(Migrations.MIGRATION_1_2)
    )
    
    // Create version 1 database with test data
    helper.createDatabase(TEST_DB_NAME, 1).apply {
        // Insert test data
        close()
    }
    
    // Migrate to version 2
    helper.runMigrationsAndValidate(TEST_DB_NAME, 2, true, Migrations.MIGRATION_1_2)
}
```

## References

- [Room Migration Testing](https://developer.android.com/training/data-storage/room/migrating-db-versions#test)
- [Room Schema Export](https://developer.android.com/training/data-storage/room/migrating-db-versions#export-schema)
