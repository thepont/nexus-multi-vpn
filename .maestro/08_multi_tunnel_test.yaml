appId: "com.multiregionvpn"
---
# Multi-Tunnel Test
# Tests multiple tunnels running simultaneously with different apps

- launchApp

# Prerequisites: UK and FR tunnels from bootstrap
- tapOn: "Tunnels"
- assertVisible: "UK - BBC"
- assertVisible: "France - Streaming"

# ============================================
# STEP 1: Assign multiple apps to different tunnels
# ============================================
- tapOn: "Apps"

# Assign Chrome to UK
- tapOn:
    text: "Chrome"
    optional: true
- tapOn: "UK - BBC"
- waitForAnimationToEnd

# Scroll to find another app
- scroll
- scroll
- scroll

# Assign Firefox to France (if exists)
- tapOn:
    text: "Firefox"
    optional: true
- tapOn: "France - Streaming"
- waitForAnimationToEnd

# Scroll to find third app
- scroll
- scroll
- scroll

# Assign a streaming app to UK
- tapOn:
    text: "Netflix|Disney"
    optional: true
- tapOn: "UK - BBC"
- waitForAnimationToEnd

# ============================================
# STEP 2: Start VPN (should start BOTH tunnels)
# ============================================
- tapOn:
    point: "90%,8%"  # Toggle switch in top right

# Wait for both tunnels to connect - assertion waits implicitly
- assertVisible: "Protected"

# ============================================
# STEP 3: Verify both tunnels connected
# ============================================
- tapOn: "Tunnels"
- waitForAnimationToEnd

# Both tunnels should show Connected status
- assertVisible:
    text: "Connected.*UK|UK.*Connected"
    optional: true
- assertVisible:
    text: "Connected.*France|France.*Connected"
    optional: true

# ============================================
# STEP 4: Test rapid switching
# ============================================
- tapOn: "Apps"
- tapOn: "Chrome"
- tapOn: "France - Streaming"  # Switch to FR
- waitForAnimationToEnd

# VPN should stay Protected (no disconnection) - assertion waits implicitly
- assertVisible: "Protected"

# Switch back to UK
- tapOn: "Chrome"
- tapOn: "UK - BBC"
- waitForAnimationToEnd

- assertVisible: "Protected"

# ============================================
# STEP 5: Remove app rules
# ============================================
- tapOn: "Chrome"
- tapOn: "Direct Internet"
- waitForAnimationToEnd

# Chrome should now have no rule

# ============================================
# STEP 6: Stop VPN
# ============================================
- tapOn:
    point: "90%,8%"  # Toggle switch in top right
- waitForAnimationToEnd
- assertVisible: "Disconnected"

# Both tunnels should show Disconnected
- tapOn: "Tunnels"
- assertNotVisible:
    text: "Connected.*UK|UK.*Connected"

