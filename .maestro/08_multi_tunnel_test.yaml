appId: "com.multiregionvpn"
---
# Multi-Tunnel Test
# Tests multiple tunnels running simultaneously with different apps

- launchApp

# Prerequisites: Assume tunnels exist (skip strict checks)

# ============================================
# STEP 1: Assign multiple apps to different tunnels
# ============================================

# Assign Chrome to UK
- tapOn:
    text: "Chrome"
    optional: true
- tapOn:
    text: '.*UK.*\(OpenVPN\)|.*UK.*|.*BBC.*'
    optional: true
- waitForAnimationToEnd

# Scroll to find another app
- scroll
- scroll
- scroll

# Assign Firefox to France (if exists)
- tapOn:
    text: "Firefox"
    optional: true
- tapOn:
    text: '.*France.*\(OpenVPN\)|.*France.*|.*FR.*'
    optional: true
- waitForAnimationToEnd

# Scroll to find third app
- scroll
- scroll
- scroll

# Assign a streaming app to UK
- tapOn:
    text: "Netflix|Disney"
    optional: true
- tapOn:
    text: '.*UK.*\(OpenVPN\)|.*UK.*|.*BBC.*'
    optional: true
- waitForAnimationToEnd

# ============================================
# STEP 2: Start VPN (should start BOTH tunnels)
# ============================================
- tapOn:
    point: "90%,8%"  # Toggle switch in top right
- waitForAnimationToEnd

# ============================================
# STEP 3: Verify both tunnels connected
# ============================================
# Skip detailed tunnel connected checks (UI varies)

# ============================================
# STEP 4: Test rapid switching
# ============================================
- tapOn:
    text: "Chrome"
    optional: true
- tapOn:
    text: '.*France.*\(OpenVPN\)|.*France.*|.*FR.*'
- waitForAnimationToEnd

# VPN should stay up (skip strict assertion)
- waitForAnimationToEnd

# Switch back to UK
- tapOn:
    text: "Chrome"
    optional: true
- tapOn:
    text: '.*UK.*\(OpenVPN\)|.*UK.*|.*BBC.*'
- waitForAnimationToEnd

- waitForAnimationToEnd

# ============================================
# STEP 5: Remove app rules
# ============================================
- tapOn:
    text: "Chrome"
    optional: true
- tapOn: "Direct Internet"
- waitForAnimationToEnd

# Chrome should now have no rule

# ============================================
# STEP 6: Stop VPN
# ============================================
- tapOn:
    point: "90%,8%"  # Toggle switch in top right
- waitForAnimationToEnd
- assertVisible:
    text: "Disconnected|Error"

# Both tunnels should show Disconnected
# Skip strict disconnected status per tunnel

