appId: "com.multiregionvpn"
---
# Tunnel Management Test
# Tests adding, viewing, and managing VPN tunnels

- launchApp

# Navigate to Settings first to save credentials
- tapOn: "Settings"
- tapOn:
    id: "nordvpn_username_field"
- inputText: "${NORDVPN_USERNAME}"
- tapOn:
    id: "nordvpn_password_field"
- inputText: "${NORDVPN_PASSWORD}"
- tapOn: "Save Credentials"
- assertVisible: "Credentials saved"

# Navigate to Tunnels tab
- tapOn: "Tunnels"
- assertVisible: "Add Tunnel"

# Test: Add a new tunnel
- tapOn: "Add Tunnel"
- assertVisible: "Add VPN Tunnel"  # Dialog title

# Fill in tunnel details
- tapOn:
    id: "tunnel_name_field"
- inputText: "Test UK Tunnel"

- tapOn:
    id: "tunnel_region_dropdown"
- tapOn: "United Kingdom"

- tapOn:
    id: "tunnel_provider_dropdown"
- tapOn: "NordVPN"

- tapOn: "Fetch Server"  # Auto-fetch NordVPN server

# Wait for server to be fetched
- assertVisible: ".nordvpn.com"  # Server hostname

- tapOn: "Save"

# Verify tunnel appears in list
- assertVisible: "Test UK Tunnel"
- assertVisible: "uk.*nordvpn.com"  # Server hostname in list

# Test: View tunnel details (tap on tunnel)
- tapOn: "Test UK Tunnel"
- assertVisible: "Edit"
- assertVisible: "Delete"
- assertVisible: "View Apps Using This Tunnel"

# Close menu
- tapOn:
    point: "50%,10%"  # Tap outside to close

# Test: Edit tunnel
- tapOn: "Test UK Tunnel"
- tapOn: "Edit"
- tapOn:
    id: "tunnel_name_field"
- clearText
- inputText: "UK - iPlayer"
- tapOn: "Save"
- assertVisible: "UK - iPlayer"

# Test: Delete tunnel
- tapOn: "UK - iPlayer"
- tapOn: "Delete"
- tapOn: "Confirm"  # Confirmation dialog
- assertNotVisible: "UK - iPlayer"

