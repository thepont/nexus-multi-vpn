appId: "com.multiregionvpn"
---
# App Rules Test
# Tests assigning apps to tunnels and routing configuration

- launchApp

# Ensure we have credentials and a tunnel configured
# (This test assumes bootstrap has been run)
- tapOn: "Tunnels"

# Test will FAIL if no tunnels are configured
- assertVisible:
    text: ".*BBC.*|.*France.*"  # At least one tunnel must exist

# Navigate to Apps tab
- tapOn: "Apps"
- assertVisible: "Search apps..."

# Test: Search functionality
- tapOn: "Search apps..."
- inputText: "chrome"
- assertVisible: "Chrome"

# Clear search
- eraseText
- assertVisible:
    text: ".*BBC.*|.*Disney.*|.*Netflix.*"  # Geo-blocked apps should appear

# Test: Assign an app to a tunnel
- scroll
- tapOn:
    text: "Chrome"
    optional: true

# Dialog should open
- assertVisible: "Select VPN Tunnel"

# Verify "Direct Internet" option exists
- assertVisible: "Direct Internet"

# Select a tunnel
- tapOn:
    text: ".*BBC.*|.*UK.*"
    optional: true

# Verify rule was saved (badge should turn green)
- assertVisible: "Chrome"

# Test: Change app rule
- tapOn: "Chrome"
- assertVisible: "Select VPN Tunnel"

# Switch to France tunnel
- tapOn:
    text: ".*France.*|.*FR.*"
    optional: true

# Test: Remove app rule (set to Direct Internet)
- tapOn: "Chrome"
- tapOn: "Direct Internet"

# Badge should turn gray for Chrome
- assertVisible: "Chrome"

# Test: Smart app ordering
# Geo-blocked apps should be at the top
- scroll:
    direction: UP  # Scroll to top
    repeat: 5

# UK apps should be visible near top
- assertVisible:
    text: "BBC iPlayer"
    optional: true
- assertVisible:
    text: "All 4"
    optional: true

