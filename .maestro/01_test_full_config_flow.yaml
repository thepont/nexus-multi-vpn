appId: "com.multiregionvpn"
---
- launchApp

- waitForAnimationToEnd
## Ensure list is in a stable position
- swipe:
    start: "50%,20%"
    end: "50%,80%"
    duration: 200
- swipe:
    start: "50%,80%"
    end: "50%,20%"
    duration: 200

# --- 1. (Optional) If navigated to Settings, return to Tunnels ---
- tapOn:
    text: "Tunnels"
    optional: true

# --- 2. Ensure a UK VPN Server Config exists (create if missing) ---
- assertVisible:
    text: '.*UK.*\(OpenVPN\)|Test .*UK.* Server'
    optional: true
- runFlow:
    when:
      notVisible: '.*UK.*\(OpenVPN\)|Test .*UK.* Server'
    commands:
      - tapOn: "UK"
      - assertVisible: "Add Server"
      - tapOn: "Friendly Name"
      - inputText: "Test UK Server"
      - tapOn: "Region"
      - tapOn: "UK"
      - tapOn: "Save"
      - assertVisible:
          text: '.*UK.*\(OpenVPN\)|Test .*UK.* Server'

# --- 3. Assign a Rule to an App ---
# Scroll and find an app to assign a rule
- scroll
- scroll
- tapOn:
    text: "Chrome"
    optional: true
- tapOn:
    text: 'Test UK Server|.*UK.*\(OpenVPN\)'
    optional: true

# --- 4. Start the VPN Service ---
- tapOn:
    point: "90%,8%"
# Handle system VPN permission dialog if it appears
- tapOn:
    text: "OK"
    optional: true
- tapOn:
    text: "Allow"
    optional: true
